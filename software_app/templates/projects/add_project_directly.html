{% extends 'base2.html' %}
{% load static %}

{% block title %}Add Project Directly{% endblock %}

{% block content %}
<div class="ribbon-header d-flex justify-content-between align-items-center px-4 pb-5 mb-3" style="color: black">
  <div class="d-flex align-items-center">
    <i class="fas fa-folder-plus me-3 fs-2" style="color: #0152a4;"></i>
    <div class="fw-bold fs-3">Add Project Directly</div>
  </div>
  <div class="breadcrumb-text text-end">
    <span class="text-black"><i class="fas fa-home me-1"></i>HOME</span>
    <span class="mx-2 text-black">/</span>
    <span class="text-black">Projects</span>
    <span class="mx-2 text-black">/</span>
    <span class="text-black-50">Add Directly</span>
  </div>
</div>

<div class="container-fluid mt-2">
  <form method="POST" action="{% url 'add_project_directly' %}" id="projectForm" enctype="multipart/form-data">
    {% csrf_token %}
    
    <!-- Client Selection Type -->
    <div class="card shadow-lg mb-4 modern-card">
      <div class="card-header table-title-bar fw-bold text-white d-flex align-items-center">
        <i class="fas fa-building me-2"></i>
        Step 1: Select Client Type
      </div>
      <div class="card-body p-4">
        <div class="step-header mb-4">
          <h5 class="text-primary"><i class="fas fa-users me-2"></i>Choose Client Option</h5>
          <hr class="title-underline">
        </div>
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <div class="client-option-card" onclick="selectClientOption('existing')">
              <input type="radio" name="client_option" id="existing_option" value="existing" required>
              <label for="existing_option" class="client-option-label">
                <i class="fas fa-users fa-3x mb-3 text-primary"></i>
                <h5>Existing Client</h5>
                <p class="text-muted">Select from existing clients database</p>
              </label>
            </div>
          </div>
          
          <div class="col-md-6 mb-3">
            <div class="client-option-card" onclick="selectClientOption('new')">
              <input type="radio" name="client_option" id="new_option" value="new" required>
              <label for="new_option" class="client-option-label">
                <i class="fas fa-user-plus fa-3x mb-3 text-success"></i>
                <h5>New Client</h5>
                <p class="text-muted">Add new client details manually</p>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Existing Client Selection (Hidden by default) -->
    <div class="card shadow-lg mb-4 modern-card d-none" id="existingClientSection">
      <div class="card-header table-title-bar fw-bold text-white d-flex align-items-center">
        <i class="fas fa-search me-2"></i>
        Step 2: Select Existing Client
      </div>
      <div class="card-body p-4">
        <div class="row">
          <div class="col-md-12 mb-3">
            <label class="form-label"><i class="fas fa-building me-2 text-primary"></i>Select Client <span class="text-danger">*</span></label>
            <select class="form-control modern-input" id="existing_client_id" name="existing_client_id">
              <option value="">-- Select Client --</option>
              {% for client in existing_clients %}
              <option value="{{ client.id }}">
                {{ client.client_id }} - {{ client.company_name }} ({{ client.contact_person }})
              </option>
              {% endfor %}
            </select>
            <small class="text-muted"><i class="fas fa-info-circle me-1"></i>Choose from existing clients</small>
          </div>
        </div>
      </div>
    </div>

    <!-- New Client Details (Hidden by default) -->
    <div class="card shadow-lg mb-4 modern-card d-none" id="newClientSection">
      <div class="card-header table-title-bar fw-bold text-white d-flex align-items-center">
        <i class="fas fa-user-plus me-2"></i>
        Step 2: New Client Details
      </div>
      <div class="card-body p-4">
        <div class="step-header mb-4">
          <h5 class="text-primary"><i class="fas fa-building me-2"></i>Client Information</h5>
          <hr class="title-underline">
        </div>
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-building me-2 text-primary"></i>Company Name <span class="text-danger">*</span></label>
            <input type="text" class="form-control modern-input" id="company_name" name="company_name" placeholder="Enter company name">
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-user-tie me-2 text-primary"></i>Contact Person <span class="text-danger">*</span></label>
            <input type="text" class="form-control modern-input" id="contact_person" name="contact_person" placeholder="Enter contact person name">
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-envelope me-2 text-primary"></i>Email</label>
            <input type="email" class="form-control modern-input" id="email" name="email" placeholder="Enter email address">
            <small class="text-muted"><i class="fas fa-info-circle me-1"></i>Optional</small>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-mobile-alt me-2 text-primary"></i>Mobile Number <span class="text-danger">*</span></label>
            <input type="tel" class="form-control modern-input" id="mobile" name="mobile" placeholder="Enter mobile number" maxlength="15">
          </div>
        </div>

        <div class="row">
          <div class="col-md-12 mb-3">
            <label class="form-label"><i class="fas fa-map-marked-alt me-2 text-primary"></i>Address</label>
            <textarea class="form-control modern-input" id="address" name="address" rows="3" placeholder="Enter company address (optional)"></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- Project Information (Always visible after client selection) -->
    <div class="card shadow-lg mb-4 modern-card d-none" id="projectSection">
      <div class="card-header table-title-bar fw-bold text-white d-flex align-items-center">
        <i class="fas fa-project-diagram me-2"></i>
        Step 3: Project Information
      </div>
      <div class="card-body p-4">
        
        <!-- Project Details -->
        <div class="step-header mb-4">
          <h5 class="text-primary"><i class="fas fa-info-circle me-2"></i>Project Details</h5>
          <hr class="title-underline">
        </div>
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-tag me-2 text-primary"></i>Project Name <span class="text-danger">*</span></label>
            <input type="text" class="form-control modern-input" id="project_name" name="project_name" placeholder="Enter project name" required>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-list me-2 text-primary"></i>Project Type <span class="text-danger">*</span></label>
            <select class="form-control modern-input" id="project_type" name="project_type" required>
              <option value="">Select Type</option>
              <option value="seo">SEO Project</option>
              <option value="development">Development Project</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-calendar-alt me-2 text-primary"></i>Start Date <span class="text-danger">*</span></label>
            <input type="date" class="form-control modern-input" id="start_date" name="start_date" max="{{ today }}" required>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-calendar-check me-2 text-primary"></i>Deadline <span class="text-danger">*</span></label>
            <input type="date" class="form-control modern-input" id="deadline" name="deadline" min="{{ today }}" required>
          </div>
        </div>

        <!-- Financial Information -->
        <div class="step-header mb-4 mt-4">
          <h5 class="text-success"><i class="fas fa-dollar-sign me-2"></i>Financial Information</h5>
          <hr class="title-underline" style="background: linear-gradient(to right, #28a745, #34ce57);">
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-money-bill-wave me-2 text-success"></i>Total Project Amount (â‚¹) <span class="text-danger">*</span></label>
            <input type="number" step="0.01" min="0.01" class="form-control modern-input" id="total_amount" name="total_amount" placeholder="Enter total project value" required>
            <small class="text-muted"><i class="fas fa-info-circle me-1"></i>Total value of this project in INR</small>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-calculator me-2 text-primary"></i>Internal Budget (Optional)</label>
            <input type="number" step="0.01" class="form-control modern-input" id="budget" name="budget" placeholder="Enter internal budget">
            <small class="text-muted"><i class="fas fa-info-circle me-1"></i>For internal planning purposes</small>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12 mb-3">
            <label class="form-label"><i class="fas fa-align-left me-2 text-primary"></i>Project Description <span class="text-danger">*</span></label>
            <textarea class="form-control modern-input" id="description" name="description" rows="5" placeholder="Enter project description" required></textarea>
          </div>
        </div>

        <!-- Document Uploads -->
        <div class="step-header mb-4 mt-4">
          <h5 class="text-primary"><i class="fas fa-file-upload me-2"></i>Document Uploads</h5>
          <hr class="title-underline">
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-file-contract me-2 text-primary"></i>Agreement Document (Optional)</label>
            <input type="file" class="form-control modern-input" id="agreement" name="agreement" accept=".pdf,.doc,.docx">
            <small class="text-muted"><i class="fas fa-info-circle me-1"></i>Supported formats: PDF, DOC, DOCX</small>
          </div>

          <div class="col-md-6 mb-3">
            <label class="form-label"><i class="fas fa-file-archive me-2 text-primary"></i>Module/Resource File (Optional)</label>
            <input type="file" class="form-control modern-input" id="module_file" name="module_file" accept=".zip,.rar,.pdf,.doc,.docx,.xlsx">
            <small class="text-muted"><i class="fas fa-info-circle me-1"></i>Supported formats: ZIP, RAR, PDF, DOC, DOCX, XLSX</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="text-end mb-4">
      <a href="{% url 'project_list' %}" class="btn btn-secondary btn-nav">
        <i class="fas fa-times me-2"></i>Cancel
      </a>
      <button type="submit" class="btn btn-success btn-nav">
        <i class="fas fa-check-circle me-2"></i>Create Project
      </button>
    </div>
  </form>
</div>

<script>
function selectClientOption(option) {
  // Update radio button
  if (option === 'existing') {
    document.getElementById('existing_option').checked = true;
  } else {
    document.getElementById('new_option').checked = true;
  }
  
  // Show/hide sections
  const existingSection = document.getElementById('existingClientSection');
  const newSection = document.getElementById('newClientSection');
  const projectSection = document.getElementById('projectSection');
  
  if (option === 'existing') {
    existingSection.classList.remove('d-none');
    newSection.classList.add('d-none');
    projectSection.classList.remove('d-none');
    
    // Make existing client field required
    document.getElementById('existing_client_id').setAttribute('required', 'required');
    
    // Remove required from new client fields
    document.getElementById('company_name').removeAttribute('required');
    document.getElementById('contact_person').removeAttribute('required');
    document.getElementById('mobile').removeAttribute('required');
    
  } else {
    existingSection.classList.add('d-none');
    newSection.classList.remove('d-none');
    projectSection.classList.remove('d-none');
    
    // Remove required from existing client field
    document.getElementById('existing_client_id').removeAttribute('required');
    
    // Make new client fields required
    document.getElementById('company_name').setAttribute('required', 'required');
    document.getElementById('contact_person').setAttribute('required', 'required');
    document.getElementById('mobile').setAttribute('required', 'required');
  }
}

// Validate deadline is after start date
document.getElementById('start_date').addEventListener('change', function() {
  document.getElementById('deadline').min = this.value;
});

document.getElementById('deadline').addEventListener('change', function() {
  const startDate = document.getElementById('start_date').value;
  if (startDate && this.value < startDate) {
    alert('Deadline cannot be before start date!');
    this.value = '';
  }
});

// Format currency input
document.getElementById('total_amount').addEventListener('blur', function() {
  if (this.value) {
    this.value = parseFloat(this.value).toFixed(2);
  }
});

document.getElementById('budget').addEventListener('blur', function() {
  if (this.value) {
    this.value = parseFloat(this.value).toFixed(2);
  }
});

// Form validation
document.getElementById('projectForm').addEventListener('submit', function(e) {
  const clientOption = document.querySelector('input[name="client_option"]:checked');
  
  if (!clientOption) {
    e.preventDefault();
    alert('Please select a client option (Existing or New)!');
    return false;
  }
  
  if (clientOption.value === 'existing') {
    const existingClient = document.getElementById('existing_client_id').value;
    if (!existingClient) {
      e.preventDefault();
      alert('Please select an existing client!');
      return false;
    }
  } else {
    const companyName = document.getElementById('company_name').value.trim();
    const contactPerson = document.getElementById('contact_person').value.trim();
    const mobile = document.getElementById('mobile').value.trim();
    
    if (!companyName || !contactPerson || !mobile) {
      e.preventDefault();
      alert('Please fill all required client fields!');
      return false;
    }
  }
});
</script>

<style>
  .modern-card {
    border-radius: 15px;
    border: none;
    overflow: hidden;
  }

  .modern-input {
    border: 2px solid #e0e0e0 !important;
    border-radius: 10px;
    padding: 12px 15px;
    transition: all 0.3s ease;
    color: #000;
  }

  .modern-input:focus {
    border-color: #0152a4 !important;
    background-color: #f8f9ff !important;
    box-shadow: 0 0 0 0.2rem rgba(1, 82, 164, 0.15);
    transform: translateY(-2px);
  }

  .form-label {
    font-weight: 600;
    color: #333;
    margin-bottom: 8px;
  }

  .step-header h5 {
    font-weight: 700;
    display: inline-flex;
    align-items: center;
  }

  .title-underline {
    width: 100px;
    height: 3px;
    background: linear-gradient(to right, #0152a4, #28a745);
    border: none;
    margin-top: 10px;
  }

  .btn-nav {
    padding: 12px 30px;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
    margin: 0 5px;
  }

  .btn-nav:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }

  .card-header.table-title-bar {
    padding: 20px;
    font-size: 18px;
    border-bottom: 3px solid rgba(255,255,255,0.2);
  }

  .ribbon-header {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  }

  .client-option-card {
    border: 3px solid #e0e0e0;
    border-radius: 15px;
    padding: 30px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    position: relative;
  }

  .client-option-card:hover {
    border-color: #0152a4;
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(1, 82, 164, 0.2);
    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
  }

  .client-option-card input[type="radio"] {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 25px;
    height: 25px;
    cursor: pointer;
  }

  .client-option-card input[type="radio"]:checked + .client-option-label {
    color: #0152a4;
  }

  .client-option-card input[type="radio"]:checked {
    accent-color: #0152a4;
  }

  .client-option-label {
    cursor: pointer;
    margin: 0;
    padding-top: 10px;
  }

  .client-option-label h5 {
    font-weight: 700;
    margin: 15px 0 10px 0;
  }

  .client-option-label p {
    margin: 0;
  }
</style>
{% endblock %}